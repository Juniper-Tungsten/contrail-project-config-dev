- pipeline:
    name: check
    description: |
      Newly uploaded patchsets enter this pipeline to receive an
      initial +/-1 Verified vote.
    manager: independent
    trigger:
      gerrit:
        - event: patchset-created
        - event: change-restored
        - event: comment-added
          comment: (?i)^(Patch Set [0-9]+:)?( [\w\\+-]*)*(\n\n)?\s*recheck
        - event: comment-added
          require-approval:
            - verified: [-1, -2]
              username: zuul
          approval:
            - workflow: 1
      github:
        - event: pull_request
          action:
            - opened
            - changed
            - reopened
        - event: pull_request
          action: comment
          comment: (?i)^\s*recheck\s*$
    start:
      github:
        status: pending
        comment: false
    success:
      gerrit:
        # Note that gerrit keywords are case-sensitive.
        Verified: 1
      github:
        status: 'success'
    failure:
      gerrit:
        Verified: -1
      github:
        status: 'failure'

- job:
    name: base
    parent: null
    description: |
      The base job for OpenStack's installation of Zuul.
      All jobs ultimately inherit from this.  It runs a pre-playbook
      which copies all of the job's prepared git repos on to all of
      the nodes in the nodeset.  It runs a post-playbook which copies
      all of the files in the logs/ subdirectory of the executor
      work directory to the logserver.
      It also sets default timeout and nodeset values (which may be
      overidden).
    pre-run: playbooks/base/pre
    post-run:
      - playbooks/base/post-ssh
      - playbooks/base/post-logs
    roles:
      - zuul: openstack-infra/zuul-jobs
      - zuul: openstack-infra/openstack-zuul-jobs
    timeout: 1800
    nodeset:
      nodes:
        - name: ubuntu-xenial
          label: ubuntu-xenial
    secrets:
      - site_logs

- secret:
    name: site_logs
    data:
      fqdn: logs2.opencontrail.lorg
      path: /var/www/logs/
      ssh_known_hosts: |
        logs2.opencontrail.org ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDUEfDbUc6EA8S7C0RJJxp1x+CrfviKzV2iiL7iWOkS6QwA1y4/uwnY/2w2aCOW+2xsHq++lrKp0yx/9C9weqrYAyz8v6C5FCv/5MT7lTUmKe4ti6d7/3ruodJqmA1qEiSFiR9r1XA+nJL4AfzMO0SN3cfRIzI/gDna2k+v1UASOLdp0FKklOTnq4Gp/5PBn3L5NbLPSS56x+sVJYOWtYmm4ZcStWOb8PLNklgXeAcU6c1lEyTZnKRwufcVlv24CQJi9GeRwJuE8aodVJyCUJJHHJahJddhweioAjS28+pMG+sFjb+tR7h8g4Dg8uLzEHLDMn4nU/kbJgYZzthoTxzj
      ssh_username: zuul
      ssh_private_key: test
